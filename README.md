# VRネットワーク最適化プロジェクト：BestEthernet

## 1. プロジェクトの背景と目的

VR（仮想現実）体験の品質を最大化するためには、安定した高速ネットワーク接続が不可欠です。本プロジェクトは、多様なネットワーク環境（ホテルWi-Fi、モバイルデータ等）での安定運用を目指し、以下の要件を満たすソリューションの開発を目的としています：

- 必要なビットレート：最低100 Mbps、推奨150 Mbps
- 多様なネットワーク環境での安定運用

## 2. BestEthernetソリューション

### 2.1 ネットワーク構成

プロジェクトで採用した最適なネットワーク構成は、PC経由のホットスポット接続です。

```mermaid
graph LR
    A[ホテルWi-Fi/スマホ回線] --> B[PC]
    B -->|ホットスポット| C[HMD]
    B -->|ホットスポット| D[その他のデバイス]
```

**説明**：
- PCがホテルWi-FiまたはスマホのUSBテザリングで接続
- PCでWindows標準のモバイルホットスポット機能を有効化
- HMDとその他のデバイスがPCのホットスポットに接続

**利点**：
1. 柔軟性：ホテルWi-Fiとスマホ回線の両方に対応可能
2. 安定性：PCを介することで接続の安定性が向上
3. パフォーマンス：PCの処理能力を活用して最適な接続を維持

### 2.2 BestEthernetアプリケーション

環境に応じて最適なネットワーク接続を自動的に選択・設定するBestEthernetアプリケーションを開発しました。

#### 主な機能
1. 利用可能なネットワークの検出
2. 各ネットワークの速度とパフォーマンスのリアルタイム測定
3. VR要件に基づく最適なネットワークの自動選択
4. 選択されたネットワークへの自動接続とPCホットスポットの設定
5. ユーザーインターフェースを通じた手動制御オプション

#### 動作フロー
1. アプリ起動時に利用可能なすべてのネットワークをスキャン
2. 各ネットワークの速度テストを実行（`speed_test_and_select.py`）
3. 最高のパフォーマンスを示すネットワークを選択
4. 選択されたネットワークに自動接続
5. PCのモバイルホットスポット機能を自動的に有効化（`hotspot_activator.py`）
6. 接続状態を継続的にモニタリングし、必要に応じて再最適化

## 3. 実績データ分析

### 3.1 データ概要

- 期間：2024年3月2日 〜 2024年10月22日
- 測定回数：54回
- 測定ネットワーク：hotel、iPhone、O2、イーサネット、その他

### 3.2 ネットワーク別パフォーマンス分析

#### ホテルWi-Fi (hotel)
- 平均ダウンロード速度：13.0 Mbps
- 平均アップロード速度：16.3 Mbps
- 最高速度：114.2 Mbps (ダウンロード) / 82.6 Mbps (アップロード)
- 最低速度：0.7 Mbps (ダウンロード) / 2.3 Mbps (アップロード)
- 特徴：非常に不安定。VR要件（100 Mbps）を満たす時もあれば、極端に遅い時も。

#### モバイルデータ (iPhone / O2)
- 平均ダウンロード速度：25.9 Mbps
- 平均アップロード速度：58.9 Mbps
- 最高速度：129.9 Mbps (ダウンロード) / 55.4 Mbps (アップロード)
- 最低速度：2.9 Mbps (ダウンロード) / 4.0 Mbps (アップロード)
- 特徴：ホテルWi-Fiより安定しているが、場所や時間帯による変動が大きい。

#### 有線接続 (イーサネット / Ethernet)
- 平均ダウンロード速度：6.0 Mbps
- 平均アップロード速度：15.8 Mbps
- 最高速度：24.9 Mbps (ダウンロード) / 7.7 Mbps (アップロード)
- 最低速度：0.3 Mbps (ダウンロード) / 0.6 Mbps (アップロード)
- 特徴：安定しているが、速度が要件を満たさないケースが多い。

### 3.3 重要な観察事項

1. **ネットワーク変動**：同じネットワークでも日や時間帯によって大きく性能が変動。
2. **VR要件達成率**：
   - ホテルWi-Fi：16.7% (3/18回)
   - モバイルデータ：23.1% (3/13回)
   - 有線接続：0% (0/13回)
3. **最適ネットワークの日変動**：日によって最適なネットワークが異なる。
4. **長期的傾向**：3月初旬は大きな変動と高速接続の機会があったが、中旬以降は全体的に安定し、速度は低下（約24/12 Mbps前後）。

## 4. BestEthernetユーザーガイド

### 4.2 主要機能と使用方法

#### 最速のネットワーク接続を自動で選択
**使用ツール**: `speed_test_and_select.py`
```
python speed_test_and_select.py
```

#### ネットワーク接続を手動で切り替え
**使用ツール**: `ethernet_switcher_gui.py`
```
python ethernet_switcher_gui.py
```

#### モバイルホットスポットを開始
**使用ツール**: `hotspot_activator.py`
```
python hotspot_activator.py
```

#### モバイルホットスポット用のインターフェースを選択
**使用ツール**: `hotspot_interface_selector.py`
```
python hotspot_interface_selector.py
```

#### 全てのネットワークインターフェースを有効化
**使用ツール**: `enable_all_interfaces.py`
```
python enable_all_interfaces.py
```

### 4.3 システム構成図

```mermaid
graph TD
    A[speed_test_and_select.py] -->|速度測定・選択| B[イーサネットインターフェース]
    C[ethernet_switcher_gui.py] -->|手動切り替え| B
    D[hotspot_activator.py] -->|有効化| E[モバイルホットスポット]
    F[enable_all_interfaces.py] -->|全有効化| B
    G[hotspot_interface_selector.py] -->|インターフェース選択| E
    B -->|使用| E
    H[ユーザー] -->|操作| C
    H -->|操作| G
    H -->|使用| A
    H -->|使用| D
    H -->|使用| F
```

### 4.4 注意事項とトラブルシューティング

- すべてのツールはWindows環境専用です。
- 一部の機能には管理者権限が必要です。

## 5. ネットワーク構成の問題点

以下の画像は、異なるネットワーク構成とその問題点を示しています：

![ネットワーク構成図](configuration.png)

この画像には、3つの異なるネットワーク構成が示されています：

1. **理想的な構成（問題あり）**：
   - ホテルWi-Fi → かふかルーター → HMD
   - この構成では、ルーターがWANとしてWLANを選択できない問題が指摘されています。

2. **実現しない構成**：
   - ホテルWi-Fi → かふかPC（イーサネット共有） → かふかルーター → HMD
   - この構成では、PC-ルーター間の有線接続が実現できない問題があります。

3. **妥協の構成**：
   - ホテルWi-Fi → かふかスマホ → かふかPC → HMD
   - この構成は、前述のBestEthernetソリューションに近い形態です。

これらの構成の問題点を解決するために、BestEthernetソリューションでは、PCを中心としたホットスポット接続を採用しています。これにより、ルーターの制限を回避し、より柔軟なネットワーク管理を実現しています。

## 6. 結論

BestEthernetソリューションは、PCを中心としたネットワーク構成と自動最適化アプリケーションにより、多様な環境下でのVR体験に必要な高品質なネットワーク接続を実現しました。
